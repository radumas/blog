<!DOCTYPE html>
<html>

    <head>
<meta charset="" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QGIS to Leaflet with QGIS2web</title>
<meta name="description" content="Displaying projects, thoughts, etc. while working for the LaboratÃ³rio de Transportes de Cargas at COPPE, the graduate engineering research school within the Federal University of Rio de Janeiro (UFRJ)">

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
<link rel="stylesheet" type="text/css" media="all" href="/coppe-ltc/css/style.css" />
<link rel="stylesheet" type="text/css" media="all" href="/coppe-ltc/css/jquery.mmenu.all.css" />
<link rel="stylesheet" href="/coppe-ltc/css/highlightjs.piperita.css">
<link rel="stylesheet" type="text/css"href="/coppe-ltc/css/vid.css">

<!-- Favicons generated at http://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="57x57" href="/coppe-ltc/favicons/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/coppe-ltc/favicons/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/coppe-ltc/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/coppe-ltc/favicons/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/coppe-ltc/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/coppe-ltc/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/coppe-ltc/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/coppe-ltc/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/coppe-ltc/favicons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/coppe-ltc/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/coppe-ltc/favicons/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/coppe-ltc/favicons/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/coppe-ltc/favicons/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/coppe-ltc/favicons/manifest.json">
<link rel="shortcut icon" href="/coppe-ltc/favicons/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-TileImage" content="/coppe-ltc/favicons/mstile-144x144.png">
<meta name="msapplication-config" content="/coppe-ltc/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


</head>


    <body>

    <nav id="my-menu">
  <div>
    <p>MISTI Internship with The LTC</p>
    <ul class="pages">
      <li><a href="/coppe-ltc/"><i class="fa fa-home"></i> Home</a></li>
      <li><a href="/coppe-ltc/posts/"><i class="fa fa-archive"></i> All Posts</a></li>
      <li><a href="/coppe-ltc/search/"><i class="fa fa-search"></i> Search</a></li>
    </ul>
    <p class="links">
      <a href="http://www.twitter.com/dumasraphael" target="_new"><i class="fa fa-twitter"></i></a>
      <a href="https://linkedin.com/in/DumasRaphael" target="_new"><i class="fa fa-linkedin"></i></a>
      
      <a href="https://github.com/radumas" target="_new"><i class="fa fa-github-alt"></i></a>
      <a href="http://gis.stackexchange.com/users/36886/raphael" target="_new"><i class="fa fa-stack-overflow"></i></a>
      <a href="http://www.jacobtomlinson.co.uk/feed.xml" target="_new"><i class="fa fa-rss"></i></a>
    </p>
  </div>
</nav>
<div class="menu-button" href="#menu"><i class="fa fa-bars"></i></div>


    <div class="page-content">
      <div class="wrap">
      
  
  


<div class="container-fluid single">
  <div class="row">

    <div itemscope itemtype="http://schema.org/Article" class="col-md-12 article">
      
      <div class="thumb">
        <i class="fa fa-map-marker fa-4x"></i>
      </div>
      

      <h1 class="header" itemprop="name">QGIS to Leaflet with QGIS2web</h1>

      <div class="author">
        <small><i>
          by
          <span itemprop="author">
            
            
            <span itemprop="author" itemscope itemtype="http://schema.org/Person">
              <span itemprop="name">Raphael Dumas</span>
            </span>
            
            
          </span>
          on <span itemprop="datePublished" content="2014-08-28">July 27, 2015</span>
          under mapping
        </i></small>
      </div>

      <div class="read-time">
        <small>
          2 minute read
        </small>
      </div>

      <div class="content-panel content">
        <span itemprop="articleBody"><p>My first leaflet map using the <a href="https://github.com/tomchadwin/qgis2web">qgis2web</a> QGIS plugin. It is surprisingly easy to use to make nice Leaflet maps. Though unfortunately my custom rio metro .svg icons <a href="https://github.com/tomchadwin/qgis2web/issues/95">could not display</a>.</p>

<h4>Exploring census data for Rio de Janeiro.</h4>

<p>I made the map below using the following steps:<br>
1. I made 1km buffers around every active BRT, Commuter Rail, Gondola, and Metro station.<br>
2. I intersected these buffers with census geometries, calculating the area of each polygon before and after the intersection.<br>
3. I summed up the columns for literate persons from age 18 to 65 in postgresql to get the total working age population for each polygon.<br>
4. In order to get an &quot;average age&quot; I multiplied each age column from 1 to 100 by the number of people in that age column. The following sed command was useful <code>sed -r &#39;s_([0-9]+)_\1 * &amp; \+_&#39; &lt;age_columns.txt &gt;age_multiply.txt</code> to repeat the number of the column (the age) after a multiplication symbol.<br>
5. I then summed these two variables and unioned the shapes with:  </p>

<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">nome</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">tipo_de_si</span><span class="p">,</span>  
    <span class="k">SUM</span><span class="p">(</span> <span class="n">x_area</span><span class="o">/</span><span class="n">original_area</span> <span class="o">*</span><span class="n">working_age_pop</span><span class="p">),</span>  
    <span class="n">ST_Union</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">geom</span><span class="p">)</span> <span class="k">as</span> <span class="n">geom</span>  
    <span class="k">INTO</span> <span class="n">rio_stations_stats</span>  
<span class="k">FROM</span> <span class="n">alfab_rio_stations_1000</span> <span class="n">a</span>  
    <span class="k">group</span> <span class="k">by</span> <span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">nome</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">tipo_de_si</span><span class="p">;</span></code></pre></div>

<p>Finally:<br>
6. I colour-coded each line according to their official colours.<br>
7. And then used the plugin to create the map below.</p>

<p>Click <a href="/coppe-ltc/mapping/transit_working_age/index.html">here</a> for a full page map.</p>

<iframe src="/coppe-ltc/mapping/transit_working_age/index.html" height="600" width="900" frameborder="0" allowfullscreen>&nbsp; </iframe>

<h4>Thoughts</h4>

<p>The metro serves the denser areas (obviously), though the favela of Complexo Alemao, served by the gondola, is very high density.
The difference in average age was rather remarkable. With much older average ages in the core and substantially younger ones in the periphery.</p>

<h4>Wishes</h4>

<p>It would be nice if the plugin:<br>
1. Could let you edit the variable names in the popups.<br>
2. Didn&#39;t display the basemap radio button.<br>
3. Respected layer order. If you turn a layer off and then on, it automatically displays on top. </p>

<p>Further things for me to play with:<br>
1. Displaying the legend in two columns<br>
2. Disabling scroll zoom <a href="http://gis.stackexchange.com/questions/111887/leaflet-mouse-wheel-zoom-only-after-click-on-map">without clicking on the map</a><br>
3. Restricting zoom levels<br>
4. I want to figure out how to display a table of the data as well, and then maybe do some linking and brushing to highlight, for example, the stations with the oldest average population.  </p>
</span>

        

        <div class="tags"><small>
          <i class="fa fa-tags"></i>
            QGIS, leaflet, census
        </small></div>

      </div>

      <div class="content-panel feedback">
        I <i class="fa fa-heart"></i> feedback.<br />
        Let me know what you think of this article on twitter <a href="http://www.twitter.com/dumasraphael">@dumasraphael</a> or leave a comment below!
      </div>

      

      <div class="content-panel related clearfix">
        
        <hr />
        <div class="previous previous-next">
          
        </div>
        <div class="next previous-next">
          
        </div>
      </div>

    </div>

  </div>

</div>



      </div>
    </div>

    <div class="footer clearfix">
  <div class="col-md-6">
    Made by <a href="https://twitter.com/DumasRaphael">Raphael Dumas</a>
  </div>
  <div class="col-md-6">
    Carte-Noire theme by <a href="https://twitter.com/_JacobTomlinson">Jacob Tomlinson</a> <i class="fa fa-code-fork"></i> on <a href="https://github.com/jacobtomlinson/carte-noire">Github</a> &nbsp;<i class="fa fa-github-alt"></i>
  </div>
</div>

<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<script src="/coppe-ltc/js/jquery.mmenu.min.all.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
   $(document).ready(function() {
      $("#my-menu").mmenu().on( "closed.mm", function() {
            $(".menu-button").show();
         });
      $(".menu-button").click(function() {
        $(".menu-button").hide();
        $("#my-menu").trigger("open.mm");
      });
   });
</script>




    </body>
</html>
